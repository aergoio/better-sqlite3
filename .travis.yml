language: node_js
sudo: false
matrix:
  include:
    - name: "Linux - Node 10"
      os: linux
      node_js: "10"
      env:
        - CXX=g++-4.9
        - CC=gcc-4.9
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - gcc-4.9
          - g++-4.9
    - name: "Linux - Node 12"
      os: linux
      node_js: "12"
      env:
        - CXX=g++-4.9
        - CC=gcc-4.9
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - gcc-4.9
          - g++-4.9
    - name: "OS X - Node 10"
      os: osx
      node_js: "10"
      osx_image: xcode11
      compiler: clang
      env:
        - CXX=g++
        - CC=gcc
    - name: "OS X - Node 12"
      os: osx
      node_js: "12"
      osx_image: xcode11
      compiler: clang
      env:
        - CXX=g++
        - CC=gcc
before_script:
- npm run build-debug
before_deploy:
- npm run build-release
- $(npm bin)/prebuild -r node -t 10.20.0 -t 12.0.0 --include-regex 'better_sqlite3.node$'
- $(npm bin)/prebuild -r electron -t 4.0.0 -t 5.0.0 -t 6.0.0 -t 7.0.0 -t 8.0.0 --include-regex 'better_sqlite3.node$'
deploy:
  provider: releases
  api_key:
    secure: SKIMBrq2eYpDZNFtWPqO2JLu1AD/T7eU0J3gJ/BMTdH/NUz8iKjqk7m3YYiWTZt6d8PLdRMBaEipZBxMVhFya0qfM4+JYILIcqrXC3xP08XQJj0tue3hJ+uvobwCByH4/F1Sm+DiljtyawOEWa92N03SZS03GSQRkl+uIqtB0JnwPewVDnBeCGI1zLZ7o8IMsJea4jnEpBlw8mENaJaat3TltbC7au5PuVDRhgL18jP1i5nZB+rxznvVKEliNdn0sOEvQMh/Gr2uiUm4+AC8S0ZlwU3NlnsFC4ZzLx90xtKRMAZmPYHtYdGi0INe/rdAgFlnRaDekuRSNa0e593XNMzrUNBy4zoeoFnFqwXC7k1ycbN5in+CSK8mza4nRnqvQLJ5vwNyut7iS+xP3rFHJQsORJG7Q32uWfoWu/lOGUnd/uS+1Tl/nKb7Zw6K/ffofAnD3UwOOlvlm6cujVi0Op+sh9GYydas1QPB2VJMiH5h1P+KNXqhP4gBL7APDA9QBAyu/BnzQBVCkal8xZXHmQuiVCNzYR672DFP8cYpbterHxT2QYOeTuhuX1MrxWIe+qEkZRRDoVmMwOH52sBQJd0PhIK4VnIKGyaJcFsPdsf71WIA96qL8XYj+Lw8WSHiTS50g2ZKIo2P8Deu4Ex+1tpDQb+DVcHeEgL8QqDHNfk=
  file: prebuilds/*
  file_glob: true
  skip_cleanup: true
  on:
    repo: aergoio/better-sqlite3-aergolite
    tags: true
    node_js: "12"
